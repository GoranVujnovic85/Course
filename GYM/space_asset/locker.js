
const data = {
  results: {
    "tags": [
      {
        "id": 65,
        "is_active": true,
        "is_linked": true,
        "name": "Daily Snack",
        "type": "packages",
        "createdAt": "2024-11-07T18:27:37.000Z",
        "updatedAt": "2024-11-09T00:15:02.000Z"
      },
      {
        "id": 64,
        "is_active": true,
        "is_linked": true,
        "name": "Daily Base",
        "type": "packages",
        "createdAt": "2024-11-07T18:27:37.000Z",
        "updatedAt": "2024-11-07T18:27:37.000Z"
      },
      {
        "id": 63,
        "is_active": true,
        "is_linked": true,
        "name": "Daily Dessert",
        "type": "packages",
        "createdAt": "2024-11-07T18:27:37.000Z",
        "updatedAt": "2024-11-09T00:15:02.000Z"
      },
      {
        "id": 62,
        "is_active": true,
        "is_linked": true,
        "name": "Daily Side",
        "type": "packages",
        "createdAt": "2024-11-07T18:27:37.000Z",
        "updatedAt": "2024-11-07T18:27:37.000Z"
      },
      {
        "id": 61,
        "is_active": true,
        "is_linked": true,
        "name": "Daily Main",
        "type": "packages",
        "createdAt": "2024-11-07T18:27:37.000Z",
        "updatedAt": "2024-11-07T18:27:37.000Z"
      },
      {
        "id": 60,
        "is_active": true,
        "is_linked": true,
        "name": "Dessert",
        "type": "category",
        "createdAt": "2024-10-10T09:54:23.000Z",
        "updatedAt": "2024-10-25T00:15:01.000Z"
      },
      {
        "id": 59,
        "is_active": true,
        "is_linked": true,
        "name": "Side",
        "type": "category",
        "createdAt": "2024-10-10T09:54:11.000Z",
        "updatedAt": "2024-10-19T00:15:02.000Z"
      },
      {
        "id": 58,
        "is_active": true,
        "is_linked": true,
        "name": "Main",
        "type": "category",
        "createdAt": "2024-10-10T09:54:07.000Z",
        "updatedAt": "2024-10-19T00:15:02.000Z"
      },
      {
        "id": 57,
        "is_active": true,
        "is_linked": true,
        "name": "Base",
        "type": "category",
        "createdAt": "2024-10-10T09:54:01.000Z",
        "updatedAt": "2024-10-23T19:39:29.000Z"
      },
      {
        "id": 56,
        "is_active": true,
        "is_linked": true,
        "name": "Snack",
        "type": "category",
        "createdAt": "2024-10-10T09:53:55.000Z",
        "updatedAt": "2024-11-05T00:15:02.000Z"
      },
      {
        "id": 55,
        "is_active": true,
        "is_linked": false,
        "name": "Bronze Sandwiches",
        "type": "packages",
        "createdAt": "2024-10-10T09:53:34.000Z",
        "updatedAt": "2024-10-10T09:53:34.000Z"
      },
      {
        "id": 54,
        "is_active": true,
        "is_linked": false,
        "name": "Bronze",
        "type": "packages",
        "createdAt": "2024-10-10T09:53:15.000Z",
        "updatedAt": "2024-10-10T09:53:15.000Z"
      },
      {
        "id": 53,
        "is_active": true,
        "is_linked": false,
        "name": "Silver",
        "type": "packages",
        "createdAt": "2024-10-10T09:53:08.000Z",
        "updatedAt": "2024-10-10T09:53:08.000Z"
      },
      {
        "id": 52,
        "is_active": true,
        "is_linked": false,
        "name": "Gold",
        "type": "packages",
        "createdAt": "2024-10-10T09:53:01.000Z",
        "updatedAt": "2024-10-10T09:53:01.000Z"
      },
      {
        "id": 34,
        "is_active": true,
        "is_linked": true,
        "name": "Product Launch",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 33,
        "is_active": true,
        "is_linked": true,
        "name": "Team Building",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 35,
        "is_active": true,
        "is_linked": true,
        "name": "Training Session",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 36,
        "is_active": true,
        "is_linked": true,
        "name": "Networking Event",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 37,
        "is_active": false,
        "is_linked": true,
        "name": "Summer Party",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 38,
        "is_active": true,
        "is_linked": true,
        "name": "Seasonal Party",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 39,
        "is_active": true,
        "is_linked": true,
        "name": "Eid",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 40,
        "is_active": true,
        "is_linked": true,
        "name": "Diwali",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 41,
        "is_active": true,
        "is_linked": true,
        "name": "Halloween",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 42,
        "is_active": false,
        "is_linked": true,
        "name": "Christmas",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 43,
        "is_active": false,
        "is_linked": true,
        "name": "Valentines",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 44,
        "is_active": true,
        "is_linked": true,
        "name": "Thanksgiving",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 45,
        "is_active": true,
        "is_linked": true,
        "name": "Birthdays",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 46,
        "is_active": true,
        "is_linked": true,
        "name": "Chinese New Year",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 47,
        "is_active": false,
        "is_linked": true,
        "name": "St. Patrick Day",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 48,
        "is_active": false,
        "is_linked": true,
        "name": "Easter",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 49,
        "is_active": true,
        "is_linked": true,
        "name": "Mothers Day",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 50,
        "is_active": true,
        "is_linked": true,
        "name": "New Year",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 51,
        "is_active": false,
        "is_linked": true,
        "name": "International Womans Day",
        "type": "calendar",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 32,
        "is_active": false,
        "is_linked": true,
        "name": "Fundraiser",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 11,
        "is_active": true,
        "is_linked": true,
        "name": "Organic",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 12,
        "is_active": true,
        "is_linked": true,
        "name": "Canapés",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 13,
        "is_active": true,
        "is_linked": true,
        "name": "Desserts",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 14,
        "is_active": false,
        "is_linked": true,
        "name": "Snacks",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 15,
        "is_active": true,
        "is_linked": true,
        "name": "Finger Food",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 16,
        "is_active": true,
        "is_linked": true,
        "name": "Afternoon Tea",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 17,
        "is_active": false,
        "is_linked": true,
        "name": "Dinner",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 18,
        "is_active": true,
        "is_linked": true,
        "name": "Breakfast",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 19,
        "is_active": true,
        "is_linked": true,
        "name": "Lunch",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 20,
        "is_active": true,
        "is_linked": true,
        "name": "Platters",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 21,
        "is_active": false,
        "is_linked": true,
        "name": "Bundles",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 23,
        "is_active": false,
        "is_linked": true,
        "name": "Pastries",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 24,
        "is_active": true,
        "is_linked": true,
        "name": "Cakes",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 25,
        "is_active": true,
        "is_linked": true,
        "name": "Cocktails / Bar",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 26,
        "is_active": false,
        "is_linked": true,
        "name": "Tea / Coffee",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 27,
        "is_active": true,
        "is_linked": true,
        "name": "Corporate Event",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 28,
        "is_active": true,
        "is_linked": true,
        "name": "Meeting",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 29,
        "is_active": true,
        "is_linked": true,
        "name": "Celebration",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 30,
        "is_active": false,
        "is_linked": true,
        "name": "Treat",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 31,
        "is_active": true,
        "is_linked": true,
        "name": "Workshop",
        "type": "event",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 22,
        "is_active": true,
        "is_linked": true,
        "name": "Sweets",
        "type": "category",
        "createdAt": "2024-04-16T05:44:23.000Z",
        "updatedAt": "2024-04-16T05:44:23.000Z"
      },
      {
        "id": 2,
        "is_active": true,
        "is_linked": true,
        "name": "Vegan",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:22.000Z",
        "updatedAt": "2024-04-16T05:44:22.000Z"
      },
      {
        "id": 3,
        "is_active": false,
        "is_linked": true,
        "name": "Gluten-free",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:22.000Z",
        "updatedAt": "2024-04-16T05:44:22.000Z"
      },
      {
        "id": 4,
        "is_active": true,
        "is_linked": true,
        "name": "Nut-Free",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:22.000Z",
        "updatedAt": "2024-04-16T05:44:22.000Z"
      },
      {
        "id": 5,
        "is_active": true,
        "is_linked": true,
        "name": "Halal",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:22.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 6,
        "is_active": true,
        "is_linked": true,
        "name": "Kosher",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:22.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 7,
        "is_active": false,
        "is_linked": true,
        "name": "Dairy-Free",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:22.000Z",
        "updatedAt": "2024-04-16T05:44:22.000Z"
      },
      {
        "id": 8,
        "is_active": true,
        "is_linked": true,
        "name": "Low-Carb",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:22.000Z",
        "updatedAt": "2024-04-16T05:44:22.000Z"
      },
      {
        "id": 9,
        "is_active": true,
        "is_linked": true,
        "name": "High-Protein",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:22.000Z",
        "updatedAt": "2024-06-24T04:24:06.000Z"
      },
      {
        "id": 10,
        "is_active": true,
        "is_linked": true,
        "name": "Keto",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:22.000Z",
        "updatedAt": "2024-04-16T05:44:22.000Z"
      },
      {
        "id": 1,
        "is_active": false,
        "is_linked": true,
        "name": "Vegetarian",
        "type": "dietry",
        "createdAt": "2024-04-16T05:44:21.000Z",
        "updatedAt": "2024-04-16T05:44:21.000Z"
      }
    ],
    "paginate": {
      "total": 65,
      "limit": 100,
      "offset": 0,
      "order": [
        [
          "createdAt",
          "DESC"
        ]
      ]
    }
  }
}
// Define translations object with default values for English and Serbian
const translations = {
  en: {
    freeLockers: "Free Lockers",
    freeLockersMessage: "The following lockers are free:",
    noFreeLockersMessage: "No free lockers available.",
    lockersPlaceholder: "Lockers will be displayed here",
    tagId: "Tag ID",
    name: "Name",
  },
  rs: {
    freeLockers: "Slobodni ormarići",
    freeLockersMessage: "Sledeći ormarići su slobodni:",
    noFreeLockersMessage: "Nema slobodnih ormarića.",
    lockersPlaceholder: "Ormarići će biti prikazani ovde",
    tagId: "ID oznake",
    name: "Naziv",
  }
};

// Create LOCKER object as an instance of lockerClass
var LOCKER = new lockerClass();

function lockerClass() {
  // Function to change language
  this.changeLanguage = function (language) {
    // Store the selected language in localStorage
    localStorage.setItem('selectedLanguage', language);

    // Use the LANGUAGE object to change language and update content
    LANGUAGE.changeLanguage(language);  // Call the function from ChangeLanguage.js

    // Update the page content immediately after changing the language
    this.updateContent(language); // Call updateContent immediately
    this.locker(data);
    this.displayInactiveIds();
    this.datarows(data);

    console.log("changelanguage function:", localStorage.getItem('selectedLanguage'));
  };

  this.updateContent = function (language) {
    LANGUAGE.updateContent(language); // Calling function from ChangeLanguage.js

    // Setting translations for placeholder fields
    const placeholders = document.querySelectorAll('input[data-translate]'); // Use data-translate instead of placeholder
    placeholders.forEach(input => {
      const placeholderKey = input.getAttribute('data-translate'); // Get the key from the data-translate attribute
      const translatedText = this.getTranslation(placeholderKey, language); // Get the translated text using the key and language
      input.setAttribute('placeholder', translatedText); // Set the translated text as the placeholder
    });
  };

  // Locker function to calculate count and update the result display
  this.locker = function (data) {
    console.log("Running locker function..."); // Debugging line

    let count = 0;
    data.results.tags.forEach(tag => {
      if (tag.is_active === false) {
        count++;
      }
    });
    const selectedLanguage = localStorage.getItem('selectedLanguage') || 'en';
    console.log("Selected language from localStorage:", selectedLanguage); // Debugging line
    this.updateResultDisplay(count, selectedLanguage); // Update the display with the correct language and count
  }

  // Function to update the result display with the translated text and dynamic count
  this.updateResultDisplay = function (count, language) {
    const staticText = this.getTranslation('freeLockers', language);
    const resultText = `${staticText}: ${count}`;
    document.getElementById('resultDisplay').value = resultText;
  }

  // Get inactive IDs from tags
  this.getInactiveIdsFromTags = function (data) {
    let inactiveIds = [];

    if (data && data.results && Array.isArray(data.results.tags)) {
      data.results.tags.forEach(tag => {
        if (tag.is_active === false) {
          inactiveIds.push(tag.id);
        }
      });

      inactiveIds.sort((a, b) => a - b);
    } else {
      console.error("No free locker");
    }

    return inactiveIds;
  }
  this.activeClass = function (page) {
    const currentPage = window.location.pathname.split('/').pop(); // Uzmi ime trenutne stranice iz URL-a
    return currentPage === page ? 'active' : ''; // Ako je trenutna stranica ta koja je u parametru, dodaj klasu 'active'
};

  // Function to display inactive IDs in the input field
  this.displayInactiveIds = function () {
    const inactiveIds = this.getInactiveIdsFromTags(data);
    const resultDisplay = document.getElementById('resultDisplay2');

    const selectedLanguage = localStorage.getItem('selectedLanguage') || 'en';

    const inactiveLockersText = this.getTranslation('freeLockersMessage', selectedLanguage);
    const noInactiveLockersText = this.getTranslation('noFreeLockersMessage', selectedLanguage);

    if (inactiveIds.length > 0) {
      resultDisplay.value = `${inactiveLockersText} ${inactiveIds.join(', ')}`;
    } else {
      resultDisplay.value = noInactiveLockersText;
    }
    this.locker(data);
    this.datarows(data);
  }

  // Function to get all active IDs from tags
  this.getActiveIdsFromTags = function (data) {
    let activeIds = [];

    if (data && data.results && Array.isArray(data.results.tags)) {
      data.results.tags.forEach(tag => {
        if (tag.is_active === true) {
          activeIds.push(tag.id);
        }
      });

      activeIds.sort((a, b) => a - b);
    } else {
      console.error("No active locker");
    }

    return activeIds;
  }

  // Function to handle the display of data rows based on active tags
  this.datarows = function (data) {

    const activeIds = this.getActiveIdsFromTags(data);
    const tags = data.results.tags;
    const activeTags = tags.filter(tag => activeIds.includes(tag.id));
    activeTags.sort((a, b) => a.id - b.id);

    const container = document.querySelector('.data-container');
    container.innerHTML = '';

    let row;
    const selectedLanguage = localStorage.getItem('selectedLanguage') || 'en';
    const selectedTranslations = translations[selectedLanguage]; // Use translations where necessary

    activeTags.forEach((tag, index) => {
      if (index % 5 === 0) {
        row = document.createElement('div');
        row.classList.add('tag-row');
        container.appendChild(row);
      }

      const tagDiv = document.createElement('div');
      tagDiv.classList.add('tag-item');
      // bottom - up
      // --------------------------------------------------------------------------
      // top - down
      tagDiv.innerHTML = TEMPLATE.render('locker', 'datarow', [
        {
          key: 'TranslatedTagId',
          value: selectedTranslations.tagId
        },
        {
          key: 'TranslatedName',
          value: selectedTranslations.name
        },
        {
          key: 'tagId',
          value: tag.id
        },
        {
          key: 'tagName',
          value: tag.name
        },
      ])
      row.appendChild(tagDiv);
    });
  }

  // Function to get the translated text based on a key
  this.getTranslation = function (key, language) {
    // Fallback to translations object for non-LANGUAGE supported keys
    const languageTranslations = translations[language];
    if (languageTranslations && languageTranslations[key]) {
      return languageTranslations[key];
    }
    return translations['en'][key]; // Fallback to English
  }

  // Event listener for language changes
  document.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', function (event) {
      const newLanguage = event.target.getAttribute('data-lang');
      console.log("Language changed to:", newLanguage);

      localStorage.setItem('selectedLanguage', newLanguage);
      console.log("Language saved to localStorage:", newLanguage);

      LANGUAGE.changeLanguage(newLanguage);
      LOCKER.locker(data);
      LOCKER.displayInactiveIds();
      LOCKER.datarows(data);
    });
  });

  // Call locker and datarows when page loads
  document.addEventListener('DOMContentLoaded', function () {
    const selectedLanguage = localStorage.getItem('selectedLanguage') || 'en';
    LOCKER.updateContent(selectedLanguage);
    LOCKER.locker(data);
    LOCKER.displayInactiveIds();
  });
}